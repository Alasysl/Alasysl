<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>BIGBASE BINGO | 冷藍水晶彩球機</title>
<style>
:root{
  --edge-ice:#eaffff; 
  --led-cyan:#7df3ff;
  --gold:#ffcc00;
}
*{box-sizing:border-box;}

body{
  margin:0;
  background:
    linear-gradient(rgba(0,0,0,.35),rgba(0,0,0,.35)),
    url('https://i.meee.com.tw/f1THqTQ.png') center/cover no-repeat fixed;
  font-family: "Comic Sans MS","Microsoft JhengHei",system-ui,-apple-system,sans-serif;
  color:#fff; overflow-x:hidden; overflow-y:auto;
}

/* ======== 標題置於畫面上半區中央 ======== */
.header{
  position:fixed;
  top:5vh;
  left:50%;
  transform:translate(-50%,-50%);
  text-align:center;
  font-size:clamp(36px,4.2vw,60px);
  font-weight:900;
  letter-spacing:.5px;
  color:#eaffff;
  text-shadow:
    0 0 12px rgba(255,255,255,.6),
    0 0 25px rgba(125,243,255,.6),
    0 0 40px rgba(47,179,255,.5);
  z-index:5;
  user-select:none;
}

/* ======== 主要容器 ======== */
.container{
  position:relative; z-index:3;
  display:grid; grid-template-columns:5fr minmax(10px,1fr) 4fr;
  align-items:center;
  gap:clamp(12px,2vw,24px);
  padding:clamp(220px,24vh,260px) clamp(12px,3vw,36px) clamp(28px,6vh,48px);
  width:100%; max-width:1920px; margin:0 auto;
}
.left{display:flex;justify-content:center;align-items:center;}
.right{display:flex;justify-content:flex-start;}

/* ======== 彩球機（冷藍水晶） ======== */
.crystal-machine{
  position:relative;
  width:clamp(320px,34vw,640px);
  aspect-ratio:1/1;
  filter:drop-shadow(0 10px 24px rgba(0,0,0,.35));
}
.dome{
  position:relative; width:100%; height:100%;
  border-radius:50%; overflow:hidden;
  background:
    radial-gradient(140% 100% at 20% 10%,rgba(255,255,255,.45)0%,rgba(255,255,255,0)55%),
    radial-gradient(120% 120% at 80% 0%,rgba(255,255,255,.25)0%,rgba(255,255,255,0)60%),
    radial-gradient(100% 100% at 50% 55%,rgba(115,208,255,.25),rgba(47,179,255,.08));
  border:clamp(3px,.4vw,6px) solid var(--edge-ice);
  box-shadow:inset 0 0 60px rgba(255,255,255,.35),0 0 40px rgba(125,243,255,.25);
}
.dome::after{
  content:""; position:absolute; inset:-10px; border-radius:50%;
  background:conic-gradient(from 0deg,
    rgba(125,243,255,0)0 14%,rgba(125,243,255,.35)16%,rgba(255,255,255,0)22%,
    rgba(125,243,255,0)45%,rgba(125,243,255,.28)68%,rgba(255,255,255,0)76%,rgba(125,243,255,0)100%);
  filter:blur(2px); animation:hue 7s linear infinite;
}
@keyframes hue{to{filter:hue-rotate(360deg) blur(2px);}}
.shine{
  position:absolute; inset:-35% -35%; width:170%; height:170%;
  background:linear-gradient(120deg,transparent 40%,rgba(255,255,255,.75)50%,transparent 60%);
  mix-blend-mode:screen; opacity:.28; animation:sweep 6.5s ease-in-out infinite;
}
@keyframes sweep{
  0%{transform:rotate(-35deg) translate(-8%,-8%);opacity:.18;}
  50%{transform:rotate(25deg) translate(8%,8%);opacity:.35;}
  100%{transform:rotate(60deg) translate(14%,14%);opacity:.18;}
}

/* ======== 球與中獎區 ======== */
.ball{
  position:absolute; width:40px; height:40px; border-radius:50%;
  background-size:contain; background-repeat:no-repeat; background-position:center;
  filter:drop-shadow(0 3px 4px rgba(0,0,0,.35));
}
.panel{
  width:100%;
  background:rgba(8,20,30,.45);
  border-left:3px solid rgba(255,255,255,.45);
  border-radius:14px; backdrop-filter:blur(6px);
  padding:clamp(12px,1.6vw,24px) clamp(16px,1.8vw,28px);
  display:flex; flex-direction:column; gap:clamp(10px,1.2vw,16px);
}
.drawn-area{
  flex:1; min-height:clamp(200px,26vh,380px);
  border:3px solid rgba(255,217,0,.6); border-radius:10px;
  background:rgba(255,255,255,.08);
  padding:10px; overflow:auto; position:relative;
}
.drawn-balls{
  display:grid;
  grid-template-columns: repeat(10, 1fr); /* 每排 10 顆 */
  gap:10px;
  justify-items:center;
}
.drawn-ball{
  width:48px; height:48px; border-radius:50%;
  background:radial-gradient(circle,#ffec88,#ff9b2f);
  display:flex; align-items:center; justify-content:center;
  color:#000; font-weight:900; border:2px solid #fff;
  box-shadow:0 0 10px #ffcc00; font-size:clamp(16px,1.5vw,22px);
}
.drawn-ball.won{animation:popIn .45s ease,glowPulse 2.4s ease-in-out infinite alternate;}
@keyframes popIn{from{transform:scale(.7);opacity:0;}to{transform:scale(1);opacity:1;}}

.gold-sweep{position:absolute;inset:0;border-radius:8px;overflow:hidden;pointer-events:none;}
.gold-sweep::after{
  content:"";position:absolute;top:0;left:-30%;width:30%;height:100%;
  background:linear-gradient(105deg,rgba(255,220,120,0)0%,rgba(255,220,120,.55)45%,rgba(255,220,120,0)100%);
  filter:blur(2px);transform:skewX(-10deg);
}
.gold-sweep.run::after{animation:sweep 0.8s ease forwards;}

.control{background:rgba(0,0,0,.5);border:2px solid rgba(255,255,255,.3);border-radius:10px;padding:12px;}
.log{margin-top:10px;height:clamp(120px,18vh,220px);overflow:auto;border:1px solid rgba(255,255,255,.5);
background:rgba(255,255,255,.08);padding:10px;border-radius:6px;font-size:clamp(14px,1.2vw,18px);}
button{background:var(--gold);border:none;padding:10px 20px;border-radius:8px;font-weight:900;cursor:pointer;box-shadow:0 0 10px var(--gold);}
button:hover{background:#ffaa00;transform:scale(1.05);}

/* ======== 動畫部分 ======== */
.fly-ball{
  position:fixed; z-index:8; width:40px; height:40px; border-radius:50%;
  background-size:contain;background-repeat:no-repeat;background-position:center;
  filter:drop-shadow(0 4px 6px rgba(0,0,0,.35));
}
.flash{
  position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
  width:0;height:0;border-radius:50%;
  background:radial-gradient(circle,rgba(255,235,150,.95)0%,rgba(255,200,60,.6)35%,rgba(255,200,60,.15)60%,rgba(255,200,60,0)70%);
  animation:flashBoom 600ms ease-out forwards;
}
@keyframes flashBoom{
  0%{width:0;height:0;opacity:0;}
  35%{width:140px;height:140px;opacity:1;}
  100%{width:180px;height:180px;opacity:0;}
}

.number-ball-transform{
  position:absolute;inset:0;display:flex;align-items:center;justify-content:center;
  border-radius:50%;
  background:radial-gradient(circle,#ffe884 0%,#ffad2f 70%);
  color:#fff;font-weight:900;font-size:20px;text-shadow:0 1px 2px rgba(0,0,0,.35);
  border:2px solid #ffd86a;
  box-shadow:0 0 25px rgba(255,240,180,.9),inset 0 0 10px rgba(255,255,255,.6);
  opacity:0;transform:scale(.6);
  animation:morphIn .6s ease forwards,glowPulse 2.4s ease-in-out infinite alternate,floatY 2.2s ease-in-out infinite alternate;
}
@keyframes morphIn{
  0%{opacity:0;transform:scale(.6);}
  60%{opacity:1;transform:scale(2.8);}  /* 放大顯眼 */
  100%{opacity:1;transform:scale(1.1);} /* 回縮停留 */
}
@keyframes glowPulse{
  0%{box-shadow:0 0 14px rgba(255,220,120,.8),inset 0 0 8px rgba(255,255,255,.6);}
  50%{box-shadow:0 0 26px rgba(255,240,180,1),inset 0 0 14px rgba(255,255,255,.8);}
  100%{box-shadow:0 0 14px rgba(255,220,120,.8),inset 0 0 8px rgba(255,255,255,.6);}
}
@keyframes floatY{from{transform:translateY(-25px);}to{transform:translateY(25px);}}

/* 雪花層 */
#snowCanvas{position:fixed;inset:0;width:100%;height:100%;pointer-events:none;z-index:2;}
.ambient-flash{position:fixed;inset:0;z-index:2;pointer-events:none;background:rgba(255,255,255,0);transition:background 500ms ease;}
.ambient-flash.on{background:rgba(255,255,255,0.08);}

/* RWD */
@media(max-width:1024px){
  .container{grid-template-columns:1fr;grid-auto-rows:auto;align-items:start;gap:clamp(14px,3vw,24px);}
  .left,.right{justify-content:center;}
  .panel{width:min(680px,92vw);}
}
</style>
</head>
<body>
<canvas id="snowCanvas"></canvas>
<div id="ambientFlash" class="ambient-flash"></div>

<div class="header">BIGBASE BINGO</div>

<div class="container">
  <div class="left">
    <div class="crystal-machine">
      <div class="dome" id="dome"><div class="shine"></div></div>
    </div>
  </div>
  <div class="gap-col"></div>
  <div class="right">
    <div class="panel">
      <div class="drawn-area" id="drawnArea">
        <div class="gold-sweep" id="goldSweep"></div>
        <div class="drawn-balls" id="drawnBalls"></div>
      </div>
      <div class="control">
        <h3>抽球設定</h3>
        <label>一次抽取數量：<input type="number" id="drawCount" min="1" max="10" value="1"></label>
		<label>抽球上限：
        <input type="number" id="drawLimit" min="25" max="101" value="25">
        </label>
        <button id="drawButton">抽球！</button>
		<button id="resetButton" style="margin-top:10px;background:#66ccff;">重置抽球</button>
        <div class="log" id="log"></div>
      </div>
    </div>
  </div>
</div>

<script>
const dome=document.getElementById('dome');
const drawnArea=document.getElementById('drawnArea');
const drawnBalls=document.getElementById('drawnBalls');
const goldSweep=document.getElementById('goldSweep');
const ambientFlash=document.getElementById('ambientFlash');
const mapleIcons=[
  'https://maplestory.io/api/GMS/219/item/4030000/icon','https://maplestory.io/api/GMS/219/item/4030001/icon',
  'https://maplestory.io/api/GMS/219/item/4030010/icon','https://maplestory.io/api/GMS/219/item/4030011/icon',
  'https://maplestory.io/api/GMS/219/item/4030013/icon','https://maplestory.io/api/GMS/219/item/4030014/icon',
  'https://maplestory.io/api/GMS/219/item/4030015/icon','https://maplestory.io/api/GMS/219/item/4030016/icon'
];
const BALL_SIZE=40,COUNT=101,BASE_SPEED=1.2;
let balls=[];
function getDomeGeom(){
  const r=dome.getBoundingClientRect();
  const size=Math.min(r.width,r.height);
  const RADIUS=size/2,BR=BALL_SIZE/2;
  return{rect:r,size,RADIUS,BR,CENTER:{x:r.left+RADIUS,y:r.top+RADIUS},INNER:RADIUS-BR};
}
function createBalls(){
  const {size,RADIUS,BR,INNER}=getDomeGeom();
  dome.querySelectorAll('.ball').forEach(n=>n.remove());balls=[];
  for(let i=0;i<COUNT;i++){
    const el=document.createElement('div');el.className='ball';
    el.style.backgroundImage=`url('${mapleIcons[Math.floor(Math.random()*mapleIcons.length)]}')`;
    let x,y;do{x=Math.random()*(size-BALL_SIZE);y=Math.random()*(size-BALL_SIZE);}
    while(Math.hypot((x+BR)-RADIUS,(y+BR)-RADIUS)>INNER);
    const vx=(Math.random()-0.5)*BASE_SPEED,vy=(Math.random()-0.5)*BASE_SPEED;
    el.style.left=x+'px';el.style.top=y+'px';
    dome.appendChild(el);balls.push({el,x,y,vx,vy,RADIUS,BR,INNER});
  }
}
function animate(){
  const g=getDomeGeom();
  for(const b of balls){
    b.x+=b.vx;b.y+=b.vy;
    const cx=b.x+b.BR,cy=b.y+b.BR,dx=cx-g.RADIUS,dy=cy-g.RADIUS,dist=Math.hypot(dx,dy);
    if(dist>g.INNER){
      const nx=dx/dist,ny=dy/dist,tx=g.RADIUS+nx*g.INNER,ty=g.RADIUS+ny*g.INNER;
      b.x=tx-b.BR;b.y=ty-b.BR;
      const vdotn=b.vx*nx+b.vy*ny;
      b.vx-=2*vdotn*nx;b.vy-=2*vdotn*ny;
    }
  }
  for(let i=0;i<balls.length;i++)
    for(let j=i+1;j<balls.length;j++){
      const a=balls[i],b=balls[j],dx=b.x-a.x,dy=b.y-a.y,dist=Math.hypot(dx,dy);
      if(dist<BALL_SIZE){
        const nx=dx/dist,ny=dy/dist,ov=(BALL_SIZE-dist)/2;
        a.x-=nx*ov;a.y-=ny*ov;b.x+=nx*ov;b.y+=ny*ov;
        const va=a.vx*nx+a.vy*ny,vb=b.vx*nx+b.vy*ny;
        a.vx+=(vb-va)*nx;a.vy+=(vb-va)*ny;b.vx+=(va-vb)*nx;b.vy+=(va-vb)*ny;
      }
    }
  for(const b of balls){b.el.style.left=b.x+'px';b.el.style.top=b.y+'px';}
  requestAnimationFrame(animate);
}
function getMiddleCircle(){
  const domeRect=dome.getBoundingClientRect();
  const panelRect=drawnArea.getBoundingClientRect();
  const cx=(domeRect.right+panelRect.left)/2;
  const cy=(domeRect.top+domeRect.height/2);
  const r=Math.max(Math.min(window.innerWidth*0.07,220),60);
  return{cx,cy,r};
}
function triggerGoldSweep(){goldSweep.classList.remove('run');void goldSweep.offsetHeight;goldSweep.classList.add('run');}
let drawn=[],logCount=0;
const HOVER_MS=1500,FLY_MS=900,STAGGER=200;
document.getElementById('drawButton').addEventListener('click',drawBalls);
function drawBalls() {
  const count = Math.max(1, parseInt(document.getElementById('drawCount').value) || 1);
  const limit = Math.max(1, parseInt(document.getElementById('drawLimit')?.value) || 25);
  const drawButton = document.getElementById('drawButton');
  const picked = [];

  // 若已達上限 → 禁用按鈕並返回
  if (drawn.length >= limit) {
    const warn = document.createElement('div');
    warn.textContent = `⚠ 已達抽球上限 (${limit} 顆)`;
    warn.style.color = '#ffcc00';
    document.getElementById('log').prepend(warn);
    drawButton.disabled = true;
    drawButton.style.opacity = 0.5;
    drawButton.style.cursor = 'not-allowed';
    return;
  }

  // 準備「尚未抽出」的號碼池
  const available = [];
  for (let i = 1; i <= limit; i++) {
    if (!drawn.includes(i)) available.push(i);
  }

  // 打亂號碼池
  for (let i = available.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [available[i], available[j]] = [available[j], available[i]];
  }

  // 抽出
  const actualCount = Math.min(count, available.length);
  for (let i = 0; i < actualCount; i++) {
    const n = available[i];
    drawn.push(n);
    picked.push(n);
  }

  // 更新紀錄
  logCount++;
  const entry = document.createElement('div');
  entry.textContent = `第${logCount}次抽球：抽出 ${picked.join(', ')}（共 ${drawn.length}/${limit} 顆）`;
  document.getElementById('log').prepend(entry);

  if (drawn.length >= limit) {
    const warn = document.createElement('div');
    warn.textContent = `⚠ 已達抽球上限 (${limit} 顆)`;
    warn.style.color = '#ffcc00';
    document.getElementById('log').prepend(warn);
    drawButton.disabled = true;
    drawButton.style.opacity = 0.5;
    drawButton.style.cursor = 'not-allowed';
  }

  // 特效閃光
  ambientFlash.classList.add('on');
  setTimeout(() => ambientFlash.classList.remove('on'), 500);

  // 🚫 不再直接 append 球，改由動畫結束後的 showWinner(num) 顯示
  launchToCircle(picked);
}
// 重置按鈕：清空所有中獎與紀錄
document.getElementById('resetButton').addEventListener('click', () => {
  drawn = [];                 // 清空已抽出的號碼
  drawnBalls.innerHTML = '';  // 清空中獎球畫面
  log.innerHTML = '';         // 清空紀錄
  drawButton.disabled = false; // 重新啟用抽球按鈕
  drawButton.style.opacity = 1;
  drawButton.style.cursor = 'pointer';

  // 可選：在 log 中顯示提示
  const info = document.createElement('div');
  info.textContent = '✅ 已重置抽球紀錄';
  info.style.color = '#7df3ff';
  document.getElementById('log').prepend(info);
});
function launchToCircle(nums){
  const domeRect=dome.getBoundingClientRect();
  const {cx,cy,r}=getMiddleCircle();
  const startX=domeRect.left+domeRect.width/2-20;
  const startY=domeRect.top+domeRect.height/2-20;
  const ease=t=>t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2;
  const bez=(p0,p1,p2,t)=>{const it=1-t;return it*it*p0+2*it*t*p1+t*t*p2;};
  nums.forEach((num,idx)=>{
    setTimeout(()=>{
      const ang=Math.random()*Math.PI*2,rad=Math.sqrt(Math.random())*r;
      const endX=cx+rad*Math.cos(ang)-20,endY=cy+rad*Math.sin(ang)-20;
      const ctrlX=(startX+endX)/2,ctrlY=Math.min(startY,endY)-(160+Math.random()*40);
      const src=balls[Math.floor(Math.random()*balls.length)];
      const fly=document.createElement('div');
      fly.className='fly-ball';
      fly.style.left=startX+'px';fly.style.top=startY+'px';
      fly.style.backgroundImage=src.el.style.backgroundImage;document.body.appendChild(fly);
      const t0=performance.now(),dur=FLY_MS;let morphed=false,flashed=false;
      function step(now){
        const tt=Math.min(1,(now-t0)/dur),t=ease(tt);
        const x=bez(startX,ctrlX,endX,t),y=bez(startY,ctrlY,endY,t);
        fly.style.left=x+'px';fly.style.top=y+'px';
        if(!flashed&&t>=0.6){flashed=true;const fx=document.createElement('div');fx.className='flash';fly.appendChild(fx);}
        if(!morphed&&t>=0.6){morphed=true;fly.style.backgroundImage='none';
          const nb=document.createElement('div');nb.className='number-ball-transform';nb.textContent=num;fly.appendChild(nb);}
        if(tt<1)requestAnimationFrame(step);
        else{setTimeout(()=>{fly.style.transition='opacity 400ms ease';fly.style.opacity='0';setTimeout(()=>fly.remove(),420);},HOVER_MS);showWinner(num);}
      }
      requestAnimationFrame(step);
    },idx*STAGGER);
  });
}
function showWinner(n){
  const el=document.createElement('div');el.className='drawn-ball won';el.textContent=n;
  drawnBalls.appendChild(el);triggerGoldSweep();
}
createBalls();animate();addEventListener('resize',()=>createBalls());
/* 雪花 */
const canvas=document.getElementById('snowCanvas'),ctx=canvas.getContext('2d');
function fit(){canvas.width=innerWidth;canvas.height=innerHeight;}
fit();addEventListener('resize',fit);
const snowImg=new Image();snowImg.src='https://i.meee.com.tw/4cdOJkn.png';
const flakes=[];const N=90;
class Flake{constructor(){this.reset();}
reset(){this.x=Math.random()*innerWidth;this.y=Math.random()*-innerHeight;this.size=Math.random()*22+14;
this.sy=Math.random()*1.3+0.6;this.sx=Math.random()*0.6-0.3;this.a=Math.random()*0.6+0.4;
this.rot=Math.random()*360;this.spin=(Math.random()-0.5)*0.35;}
upd(){this.x+=this.sx;this.y+=this.sy;this.rot+=this.spin;if(this.y>innerHeight)this.reset();}
draw(){ctx.save();ctx.globalAlpha=this.a;ctx.translate(this.x,this.y);ctx.rotate(this.rot*Math.PI/180);
ctx.drawImage(snowImg,-this.size/2,-this.size/2,this.size,this.size);ctx.restore();}}
function initSnow(){for(let i=0;i<N;i++)flakes.push(new Flake());loop();}
function loop(){ctx.clearRect(0,0,canvas.width,canvas.height);flakes.forEach(f=>{f.upd();f.draw();});requestAnimationFrame(loop);}
snowImg.onload=initSnow;
</script>
</body>
</html>
position:fixed
